diff --git a/portal.html b/portal.html
index b648df70c582623d42dca0d0dd9ab01b036570d9..2e718cd202d91b69f173dec2420b202316dc46bb 100644
--- a/portal.html
+++ b/portal.html
@@ -350,144 +350,173 @@
     async function apiPost(payload){
       // API_URL should exist in config.js; fallback to /api/gas if missing
       var url = (typeof API_URL === 'string' && API_URL) ? API_URL : '/api/gas';
 
       var res = await fetch(url, {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify(payload)
       });
 
       var text = await res.text();
       var data = safeJsonParse(text);
 
       if (!data){
         throw new Error('Upstream returned non-JSON response.');
       }
       if (data && data.success === false){
         throw new Error(data.error || 'Request failed.');
       }
       return data;
     }
 
     // -----------------------------
     // Rendering
     // -----------------------------
+    function getCategoryId(cat){
+      return (cat && (cat.category_id || cat.id || cat.slug || cat.name)) ? (cat.category_id || cat.id || cat.slug || cat.name) : '';
+    }
+    function getCategoryName(cat){
+      return (cat && (cat.display_name || cat.name || cat.category_name || cat.id)) ? (cat.display_name || cat.name || cat.category_name || cat.id) : 'Category';
+    }
+    function getPageId(page){
+      return (page && (page.page_id || page.id)) ? (page.page_id || page.id) : '';
+    }
+    function getPageName(page){
+      return (page && (page.display_name || page.name || page.title || page.page_name || page.id)) ? (page.display_name || page.name || page.title || page.page_name || page.id) : 'Page';
+    }
+    function countPagesInCategory(cat){
+      var total = 0;
+      if (!cat) return total;
+      if (Array.isArray(cat.pages)) total += cat.pages.length;
+      if (Array.isArray(cat.children)){
+        cat.children.forEach(function(child){
+          total += countPagesInCategory(child);
+        });
+      }
+      return total;
+    }
+
     function renderHome(nav){
       var container = document.getElementById('cardsContainer');
       if (!container){
         throw new Error('Missing #cardsContainer in portal.html');
       }
       container.innerHTML = '';
 
       var cats = (nav && nav.categories) ? nav.categories : [];
       var pages = (nav && nav.pages) ? nav.pages : [];
 
       // Home: show categories first, then direct pages if any
       if (cats.length){
         var t1 = document.createElement('div');
         t1.className = 'sectionTitle';
         t1.textContent = 'Departments';
         container.appendChild(t1);
 
         var grid = document.createElement('div');
         grid.className = 'grid';
         cats.forEach(function(c){
           grid.appendChild(makeCard({
-            title: c.name || c.category_name || c.id || 'Category',
+            title: getCategoryName(c),
             desc: c.description || '',
-            count: c.count,
+            count: Number.isFinite(c.count) ? c.count : countPagesInCategory(c),
             onClick: function(){
               currentPath = [c];
               lastPageId = null;
-              loadCategory(c.id || c.category_id || c.slug || c.name);
+              var cid = getCategoryId(c);
+              if (!cid){
+                showError('Missing category id.');
+                return;
+              }
+              window.location.href = '/dashboard.html?cat_id=' + encodeURIComponent(cid);
             }
           }));
         });
         container.appendChild(grid);
       }
 
       if (pages.length){
         var t2 = document.createElement('div');
         t2.className = 'sectionTitle';
         t2.textContent = 'Pages';
         container.appendChild(t2);
 
         var grid2 = document.createElement('div');
         grid2.className = 'grid';
         pages.forEach(function(p){
           grid2.appendChild(makeCard({
-            title: p.name || p.title || p.page_name || p.id || 'Page',
+            title: getPageName(p),
             desc: p.description || '',
             count: p.count,
             onClick: function(){
-              lastPageId = p.id || p.page_id;
+              lastPageId = getPageId(p);
               openPage(p);
             }
           }));
         });
         container.appendChild(grid2);
       }
 
       if (!cats.length && !pages.length){
         var empty = document.createElement('div');
         empty.className = 'empty';
         empty.textContent = 'No pages available for your role.';
         container.appendChild(empty);
       }
 
       updateCrumbs();
     }
 
     function renderCategoryView(catName, pages){
       var container = document.getElementById('cardsContainer');
       container.innerHTML = '';
 
       var t = document.createElement('div');
       t.className = 'sectionTitle';
       t.textContent = (catName || 'Department') + ' pages';
       container.appendChild(t);
 
       if (!pages || !pages.length){
         var empty = document.createElement('div');
         empty.className = 'empty';
         empty.textContent = 'No pages in this department.';
         container.appendChild(empty);
         updateCrumbs();
         return;
       }
 
       var grid = document.createElement('div');
       grid.className = 'grid';
 
       pages.forEach(function(p){
         grid.appendChild(makeCard({
-          title: p.name || p.title || p.page_name || p.id || 'Page',
+          title: getPageName(p),
           desc: p.description || '',
           count: p.count,
           onClick: function(){
-            lastPageId = p.id || p.page_id;
+            lastPageId = getPageId(p);
             openPage(p);
           }
         }));
       });
 
       container.appendChild(grid);
       updateCrumbs();
     }
 
     function makeCard(opts){
       var card = document.createElement('div');
       card.className = 'card';
       card.tabIndex = 0;
       card.role = 'button';
 
       var top = document.createElement('div');
       top.className = 'cardTop';
 
       var left = document.createElement('div');
 
       var h = document.createElement('h3');
       h.className = 'cardTitle';
       h.textContent = opts.title || 'Item';
 
       left.appendChild(h);
@@ -511,112 +540,79 @@
       }
 
       top.appendChild(left);
       top.appendChild(meta);
       card.appendChild(top);
 
       function click(){
         if (typeof opts.onClick === 'function') opts.onClick();
       }
       card.addEventListener('click', click);
       card.addEventListener('keydown', function(e){
         if (e.key === 'Enter' || e.key === ' '){
           e.preventDefault();
           click();
         }
       });
       return card;
     }
 
     function updateCrumbs(){
       // Right pill shows current dept only if we have one
       var status = document.getElementById('statusRight');
       if (!status) return;
 
       if (currentPath.length){
-        status.textContent = (currentPath[0].name || currentPath[0].category_name || 'Department');
+        status.textContent = getCategoryName(currentPath[0]);
         status.style.display = '';
       } else {
         status.textContent = '';
         status.style.display = 'none';
       }
     }
 
     // -----------------------------
     // Navigation actions
     // -----------------------------
     async function loadNav(){
       clearError();
       show('loading');
 
       var token = getToken();
       var data = await apiPost({ action:'nav', token: token });
 
       // backend may return { success:true, nav:{...} }
       var nav = data.nav || data;
 
       hide('loading');
       renderHome(nav);
     }
 
-    async function loadCategory(categoryId){
-      clearError();
-      show('loading');
-
-      var token = getToken();
-      // If your backend already returns per-category pages via nav, keep using nav and filter client-side.
-      // If you have a dedicated action like { action:'category', categoryId }, swap it here.
-      var data = await apiPost({ action:'nav', token: token });
-      var nav = data.nav || data;
-
-      var cats = (nav && nav.categories) ? nav.categories : [];
-      var pages = (nav && nav.pages) ? nav.pages : [];
-
-      // Try to find a matching category name
-      var chosen = null;
-      for (var i=0;i<cats.length;i++){
-        var c = cats[i];
-        var cid = c.id || c.category_id || c.slug || c.name;
-        if (String(cid) === String(categoryId)){ chosen = c; break; }
-      }
-      if (!chosen && currentPath.length) chosen = currentPath[0];
-
-      // Filter pages that belong to this category if page objects have category_id or category
-      var filtered = pages.filter(function(p){
-        var pid = p.category_id || p.category || p.categoryId;
-        if (pid == null) return false;
-        return String(pid) === String(categoryId);
-      });
-
-      hide('loading');
-      renderCategoryView((chosen && (chosen.name || chosen.category_name)) || 'Department', filtered);
-    }
-
     function openPage(page){
       // If you have dedicated page routes, change this.
       // For now, we route to /dashboard.html?page_id=...
-      var pageId = page.id || page.page_id;
+      var pageId = getPageId(page);
       if (!pageId){
         showError('Missing page id.');
         return;
       }
       var url = '/dashboard.html?page_id=' + encodeURIComponent(pageId);
       window.location.href = url;
     }
 
     // -----------------------------
     // Events
     // -----------------------------
     document.getElementById('logoutBtn').addEventListener('click', logout);
     document.getElementById('homeBtn').addEventListener('click', function(){
       currentPath = [];
       lastPageId = null;
       loadNav().catch(function(err){ hide('loading'); showError(err.message); });
     });
     document.getElementById('backBtn').addEventListener('click', function(){
       // simple: if in a category, go home; if on a page, browser handles back
       if (currentPath.length){
         currentPath = [];
         lastPageId = null;
         loadNav().catch(function(err){ hide('loading'); showError(err.message); });
       } else {
         window.history.back();
